PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX schema: <http://schema.org/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

# ============================================================
# QUERY 1 — LIST ALL CITIES
# Ensure that cities are present in the generated TTL.
# ============================================================
SELECT ?city ?name
WHERE {
  ?city schema:name ?name .
}
LIMIT 50


# ============================================================
# QUERY 2 — DISPLAY WIKIDATA LINKS
# Verify that every city has a linked Wikidata entity.
# ============================================================
SELECT ?city ?wikidataURI
WHERE {
  ?city owl:sameAs ?wikidataURI .
}


# ======================================================================
# QUERY 3 — CITIES MISSING WIKIDATA LINKS (EXPECTED TO RETURN NOTHING)
# We've removed the ~50 municipalities not found in Wikidata.
# This query must return an empty result set if the cleaning was successful (it's the case). 
# ======================================================================
SELECT ?city ?name
WHERE {
  ?city schema:name ?name .
  FILTER NOT EXISTS {
    ?city owl:sameAs ?wikidataURI .
  }
}


# ======================================================================
# QUERY 4 — GET THE IMAGE FROM WIKIDATA
# Test that linking via owl:sameAs enables external Wikidata queries.
# Example shown for Q1647758.
# ======================================================================
PREFIX wd: <https://www.wikidata.org/entity/>
PREFIX wdt: <https://www.wikidata.org/prop/direct/>

SELECT ?image
WHERE {
  SERVICE <https://query.wikidata.org/sparql> {
    wd:Q1647758 wdt:P18 ?image .
  }
}


# =====================================================================================
# QUERY 5 — LOCATION + POPULATION MALE/FEMALE FROM WIKIDATA
# Demonstrate real-world data enrichment using Wikidata.
#
# What this query retrieves:
#   - Coordinates of the city (wdt:P625)
#   - Male population (wdt:P1082 with qualifier pq:P21 = man)
#   - Female population (wdt:P1082 with qualifier pq:P21 = woman)
#
# (Many cities do not have male/female population breakdown in Wikidata).
# =====================================================================================
PREFIX wd: <https://www.wikidata.org/entity/>
PREFIX wdt: <https://www.wikidata.org/prop/direct/>
PREFIX p: <https://www.wikidata.org/prop/>
PREFIX pq: <https://www.wikidata.org/prop/qualifier/>

SELECT
    ?coords
    ?men
    ?women
    ?populationDate
WHERE {
  SERVICE <https://query.wikidata.org/sparql> {

    # --- Coordinates ---
    OPTIONAL {
      wd:Q1647758 wdt:P625 ?coords .
    }

    # --- Male population ---
    OPTIONAL {
      wd:Q1647758 p:P1082 ?popStatementMen .
      ?popStatementMen pq:P21 wd:Q6581072 .    # male
      ?popStatementMen wdt:P1082 ?men .
      OPTIONAL { ?popStatementMen pq:P585 ?populationDate }
    }

    # --- Female population ---
    OPTIONAL {
      wd:Q1647758 p:P1082 ?popStatementWomen .
      ?popStatementWomen pq:P21 wd:Q6581097 .  # female
      ?popStatementWomen wdt:P1082 ?women .
    }
  }
}
