@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix schema: <https://schema.org/> .
@prefix geo: <http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix dbo: <http://dbpedia.org/ontology/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix sc: <http://smartcity.linkeddata.es/lcc/ontology#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .



 ######### MAPPING FACILITES ######


########################################
# Definición mapping FACILITY
########################################

<#FacilityMap>
  rml:logicalSource [
    rml:source "../csv/combinado-updated-with-links-Final.csv";
    rml:referenceFormulation ql:CSV;
  ];

combinado-updated-with-links-Final

########################################
 ### Definición sujeto ###
 #######################################

  rr:subjectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/resource/facility/{TipoInstalacion}/{IDNOMBRE}";
    rr:class sc:Facility;
    rr:termType rr:IRI;
  ]; 



 ########################################
 ### Definición predicados-objeto ###
 ########################################

# Propiedades intrinsecas de facilites
  rr:predicateObjectMap [ rr:predicate schema:name ; rr:objectMap [ rml:reference "NOMBRE" ; rr:termType rr:Literal ] ] ;
  rr:predicateObjectMap [ rr:predicateMap [ rr:constant schema:addressRegion ] ;rr:objectMap [ rml:reference "PROVINCIA" ; rr:termType rr:Literal ] ] ;
  rr:predicateObjectMap [ rr:predicate schema:postalCode ; rr:objectMap [ rml:reference "CODIGO-POSTAL" ; rr:datatype xsd:string ] ] ;
  rr:predicateObjectMap [ rr:predicate schema:streetAddress ; rr:objectMap [ rml:reference "StreetAdressCompleta" ] ] ;
  rr:predicateObjectMap [ rr:predicate schema:telephone ; rr:objectMap [ rml:reference "TELEFONO" ] ] ;
  rr:predicateObjectMap [ rr:predicate schema:email ; rr:objectMap [ rml:reference "EMAIL" ] ] ;
  rr:predicateObjectMap [ rr:predicate sc:accessibility ; rr:objectMap [ rml:reference "ACCESIBILIDAD" ] ] ;
  rr:predicateObjectMap [ rr:predicate geo:lat ; rr:objectMap [ rml:reference "LATITUD" ; rr:datatype xsd:decimal ] ] ;
  rr:predicateObjectMap [ rr:predicate geo:long ; rr:objectMap [ rml:reference "LONGITUD" ; rr:datatype xsd:decimal ] ] ;

#Reconciliation de las facilities (por nombre)
  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [ rml:reference "NOMBRE-WIKI" ; rr:termType rr:IRI ]
  ] ;
  

########################################
# Propiedades para asignar las subclases: 
########################################



# Subclases de Facilites: tipo instalacion: library, SportsFacility, EducationalInstitution, Park

  rr:predicateObjectMap [
    rr:predicate rdf:type ;
    rr:objectMap [
      rr:template "http://smartcity.linkeddata.es/lcc/ontology#{TipoInstalacion}"
    ]
  ] ;


# Subclases de EducationalInstitution: colegio mayor, facultad ... 

rr:predicateObjectMap [
  rr:predicate rdf:type ;
  rr:objectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/ontology#{TipoUniversidad}" ;
      ]
] ;


# Subclases de SportsFacility: colegio mayor, facultad ... 

rr:predicateObjectMap [
  rr:predicate rdf:type ;
  rr:objectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/ontology#{TipoSportsCenter}" ;
      ]
] ;



########################################
# Propiedades Data Object
########################################


#### Propiedades data object comunes para todas las facilities #####

  rr:predicateObjectMap [
    rr:predicate schema:containedInPlace ;
    rr:objectMap [ rr:template "http://smartcity.linkeddata.es/lcc/resource/neighbourhood/{BARRIO}" ; rr:termType rr:IRI ] 
  ] ;

  rr:predicateObjectMap [
    rr:predicate sc:hasNearby;
    rr:objectMap [ rr:template "http://smartcity.linkeddata.es/lcc/resource/subway/{Metro}"; rr:termType rr:IRI ];
  ];
  rr:predicateObjectMap [
    rr:predicate sc:hasNearby;
    rr:objectMap [ rr:template "http://smartcity.linkeddata.es/lcc/resource/bus/{Bus}"; rr:termType rr:IRI ];
  ];
  rr:predicateObjectMap [
    rr:predicate sc:hasNearby;
    rr:objectMap [ rr:template "http://smartcity.linkeddata.es/lcc/resource/train/{Cercanias}"; rr:termType rr:IRI ];
  ];




#### Propiedades específicas de Park #####
  rr:predicateObjectMap [ rr:predicate sc:surface; rr:objectMap [ rml:reference "Superficie m²"; rr:datatype xsd:integer ] ];
  rr:predicateObjectMap [ rr:predicate sc:hasSportsFacilities; rr:objectMap [ rml:reference "tieneInstalacionesDeportivas" ] ] ;


#### Propiedades específicas de Library #####
  rr:predicateObjectMap [ rr:predicate sc:hasWifi; rr:objectMap [ rml:reference "tieneWifi" ] ];


#### Propiedades específicas de Educational Institution #####
  rr:predicateObjectMap [ rr:predicate sc:studentGender ; rr:objectMap [ rml:reference "generoAlumnos" ] ] .





########################################
# Definición mapping Neighbourhood
########################################

 ######### MAPPING Neighbourhood ######


<#NeighbourhoodMap>
  rml:logicalSource [
    rml:source "../csv/combinado-updated-with-links-Final.csv";
    rml:referenceFormulation ql:CSV;
  ];


  ########### Sujeto de Neighborhood

  rr:subjectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/resource/neighbourhood/{BARRIO}";
    rr:class dbo:Neighbourhood;
    rr:termType rr:IRI;
  ]; 


  ########### Propiedades del Dato

  rr:predicateObjectMap [
    rr:predicate schema:name;
    rr:objectMap [ rml:reference "BARRIO" ; rr:termType rr:Literal ];
  ];


  ########### Propiedades del Objeto 

  rr:predicateObjectMap [
    rr:predicate sc:locatedInDistrict;
    rr:objectMap [ rr:template "http://smartcity.linkeddata.es/lcc/resource/district/{DISTRITO}"; rr:termType rr:IRI ];
  ];

  ########## Reconciliation

  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [
      rml:reference "BARRIO-WIKI" ;
      rr:termType rr:IRI
    ]
  ] .



########################################
# Definición mapping DISTRICT
########################################

######### MAPPING DISTRICT ######

<#DistrictMap>
  rml:logicalSource [
    rml:source "../csv/combinado-updated-with-links-Final.csv";
    rml:referenceFormulation ql:CSV;
    rml:iterator [ rr:template "http://smartcity.linkeddata.es/lcc/resource/district/{DISTRITO}"];

  ];

  ########### Sujeto de DISTRICT

  rr:subjectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/resource/district/{DISTRITO}";
    rr:class dbo:District;
    rr:termType rr:IRI;
  ]; 

  ########### Propiedades del Dato 

  rr:predicateObjectMap [
    rr:predicate schema:name;
    rr:objectMap [ rml:reference "DISTRITO" ; rr:termType rr:Literal ];
  ];

  ########### Propiedades del Objeto 

  rr:predicateObjectMap [
    rr:predicate sc:locatedInMunicipality ;
    rr:objectMap [ rr:template "http://smartcity.linkeddata.es/lcc/resource/municipality/{LOCALIDAD}" ; rr:termType rr:IRI ] 
  ] ;

  ########## Reconciliation

  rr:predicateObjectMap [
  rr:predicate owl:sameAs ;
  rr:objectMap [
    rml:reference "DISTRITO-WIKI" ;
    rr:termType rr:IRI
  ]
] .


########################################
# Definición mapping MUNICIPALITY
########################################

######### MAPPING MUNICIPALITY ######

<#MunicipalityMap>
  rml:logicalSource [
    rml:source "../csv/combinado-updated-with-links-Final.csv";
    rml:referenceFormulation ql:CSV;
    rml:iterator [ rr:template "http://smartcity.linkeddata.es/lcc/resource/municipality/{LOCALIDAD}" ];
  ];

  ########### Sujeto de DISTRICT

  rr:subjectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/resource/municipality/{LOCALIDAD}" ;
    rr:class dbo:Municipality ;
    rr:termType rr:IRI ;
  ] ;

  ########### Propiedades del Dato 

  rr:predicateObjectMap [
    rr:predicate schema:name ;
    rr:objectMap [ rml:reference "LOCALIDAD" ; rr:termType rr:Literal ] 
  ] ;

  ########## Reconciliation

  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [
      rml:reference "LOCALIDAD-WIKI" ;
      rr:termType rr:IRI
    ]
  ] .



########################################
# Definición mapping SUBWAY
########################################

######### MAPPING SUBWAY ######

<#SubwayMap>
  rml:logicalSource [
    rml:source "../csv/combinado-updated-with-links-Final.csv";
    rml:referenceFormulation ql:CSV;
  ];


########### Sujeto de SUBWAY

  rr:subjectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/resource/subway/{Metro}";
    rr:class sc:Subway;
    rr:termType rr:IRI;
  ];

########### Propiedades del Dato 

  rr:predicateObjectMap [
    rr:predicate sc:hasLines;
    rr:objectMap [ rml:reference "metro_line" ; rr:datatype xsd:string ];
  ];

  rr:predicateObjectMap [
    rr:predicate sc:hasStations;
    rr:objectMap [ rml:reference "Metro_Station" ; rr:datatype xsd:string ];
  ].




########################################
# Definición mapping TRAIN
########################################

######### MAPPING TRAIN ######

<#TrainMap>
  rml:logicalSource [
    rml:source "../csv/combinado-updated-with-links-Final.csv";
    rml:referenceFormulation ql:CSV;
  ];


########### Sujeto de TRAIN

  rr:subjectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/resource/train/{Cercanias}" ;
    rr:class sc:Train ;
    rr:termType rr:IRI ;
  ] ;

########### Propiedades del Dato 

  rr:predicateObjectMap [
    rr:predicate sc:hasLines;
    rr:objectMap [ rml:reference "Cercanias Lines" ; rr:datatype xsd:string ];
  ];

  rr:predicateObjectMap [
    rr:predicate sc:hasStations;
    rr:objectMap [ rml:reference "Cercanias Station" ; rr:datatype xsd:string ];
  ].





########################################
# Definición mapping BUS
########################################

######### MAPPING BUS ######

<#BusMap>
  rml:logicalSource [
    rml:source "../csv/combinado-updated-with-links-Final.csv";
    rml:referenceFormulation ql:CSV;
  ];


########### Sujeto de BUS

  rr:subjectMap [
    rr:template "http://smartcity.linkeddata.es/lcc/resource/bus/{Bus}" ;
    rr:class sc:Bus ;
    rr:termType rr:IRI ;
  ] ;

########### Propiedades del Dato 

  rr:predicateObjectMap [
    rr:predicate sc:hasLines;
    rr:objectMap [ rml:reference "bus_line" ; rr:datatype xsd:string ];
  ].










